# .htaccess for Laravel on a subdomain when the document root cannot be set to /public
# Place this in the project root. It internally rewrites requests to the public/ folder
# and blocks access to sensitive files.

<IfModule mod_rewrite.c>
    Options -MultiViews -Indexes
    RewriteEngine On

    # Deny access to hidden files (like .env)
    RewriteRule (^|/)\. - [F]

    # Deny access to common sensitive project files
    <FilesMatch "^(?:composer\.(?:json|lock)|package\.json|package-lock\.json|artisan|server\.php|webpack\.mix\.js|phpunit\.xml|\.env)$">
        Require all denied
    </FilesMatch>

    # If request targets an existing file or directory in this root, serve it directly
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # Avoid rewriting requests that already target /public/
    RewriteCond %{REQUEST_URI} !^/public/

    # Internally rewrite everything else to the public/ folder
    RewriteRule ^(.*)$ /public/$1 [L]
</IfModule>

# Fallback for older Apache without mod_rewrite: deny listing
<IfModule !mod_rewrite.c>
    Order allow,deny
    Deny from all
</IfModule>
